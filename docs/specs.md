# **ArchGuard: 自动化架构守护者 \- 需求规格说明书**

## **1\. 项目愿景**

ArchGuard 是一个旨在与 Claude Code 深度集成的持续架构文档工具。它通过“静态分析提取 \+ AI 智能总结”的模式，解决代码与架构图不同步的问题，确保开发者始终拥有一份最新的 PlantUML 架构视图。

## **2\. 目标用户**

* **架构师**：需要确保项目整体设计不偏离初衷。  
* **高级开发人员**：在进行大规模重构时，需要快速了解现有模块关系。  
* **新入职成员**：通过自动生成的图表快速上手项目。

## **3\. 核心功能需求**

### **3.1 变更驱动触发 (Hooks)**

* **Git 集成**：支持 post-commit 或 pre-push 钩子。  
* **Claude Code 联动**：当 Claude Code 完成任务（任务完成钩子）后，自动触发架构扫描。  
* **增量检测**：仅针对本次提交（Diff）涉及的文件及其下游依赖进行局部分析。

### **3.2 高效代码指纹提取 (TS Parser)**

* **语法级过滤**：解析 TypeScript 代码，提取类（Class）、接口（Interface）、装饰器（Decorator）、导出模块（Export/Import）及公共方法签名。  
* **细节忽略**：自动剔除私有变量、函数内部实现逻辑、第三方库内部代码，只保留“架构骨架”。  
* **架构注解支持**：支持识别如 @Architecture 或 @Module 等特定注解，用于标记重点分析对象。

### **3.3 通过 Claude Code CLI 生成文档**

* **Claude Code 集成**：调用 Claude Code 命令行工具（而非直接调用 LLM API），基于 TS Parser 输出生成 PlantUML。
* **数据流**：Arch-JSON → Claude Code CLI → PlantUML 代码。
* **PlantUML 生成**：利用 Claude Code 的代码生成能力，生成规范的 PlantUML 代码（支持类图、组件图、序列图）。
* **自然语言总结**：Claude Code 可选生成关于本次变更对系统设计影响的简短描述。
* **优势**：无需管理 API Key，利用 Claude Code 现有配置和上下文能力。

### **3.4 交付物管理**

* **自动提交**：将生成的 .puml 或 .png (通过渲染引擎) 自动更新到项目的 /docs/architecture/ 目录。  
* **冲突预警**：如果 AI 检测到代码实现违反了预设的架构规则（如非法跨层调用），在控制台输出警告。

## **4\. 非功能需求**

* **性能**：在 500 个文件的项目中，静态解析时间应小于 2 秒。  
* **隐私**：只发送架构摘要（Metadata）到 AI 端，不发送具体的业务逻辑实现。  
* **易用性**：提供简单的 CLI 界面，如 archguard sync。